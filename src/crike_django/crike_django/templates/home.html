{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block header %}
<style>

.thumbnail {
text-align:center;
}
.user-profile-header {
position: relative;
padding: 30px 0;
margin-bottom: 20px;
background-color:white;
}
.header-gray {
background-color: #F3F3F3;
}

</style>
{% endblock %}

{% block container_header %}

<header class="user-profile-header header-gray">
  <div class="container">

<div class="row">

    <div id="user-info-view" class="col-md-2 pull-left">
      <div class="avatar-wrapper">
        <div class="avatar-image-container">
          {% if profile.profile_picture %}
           <img class="avatar large border" src="{{ profile.profile_picture.url }}" style="max-width:100%; max-height:100%;">
          {% else %} <!-- no head sculpture -->
          <img class="avatar large border" src="http://www.gravatar.com/avatar/73c2759e2936bc26746d0d26375aed31?d=retro&amp;s=140">
          {% endif %}
        </div>
        <button onclick="showForm('picForm')">更换头像</button>
        <form method="post" action="{% url 'user_head_sculpture' %}" enctype="multipart/form-data" style='display:none' id='picForm'>
          {% csrf_token %}
          {{ header_form|crispy }}
          <div class="control-group">
            <div class="controls">
              <button type="submit" class="btn btn-primary">上传</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div id="user-info-view" class="col-md-2 pull-left">
      <div class="user-details">
        <div class="user-details-show">
          <div class="user-identifier user-details-editable">
            <span class="username">用户名：{{ user }}</span>
          </div>
        </div>
        <div>详细信息</div>
      </div>
    </div>

    <div class="user-stats col-md-2">
      <div class="user-points-bar-container">
      <div class="points-labels">
        <span class="best">最高得分 <strong class="best-count"> {{ profile.biggest_points }} </strong></span>
      </div>
      <div class="points-labels">
        <span class="best">所有积分 <strong class="best-count"> {{ profile.total_points }} </strong></span>
      </div>
      <div class="points-labels">
        <span class="best">可用积分 <strong class="best-count"> {{ profile.usage_points }} </strong></span>
      </div>
      <!-- 今天的分数
      <div class="points-bar">
        <span class="points-bar-fill" style="width: 0.0%">今天的分数
          <span class="count-container count-right">
            <span class="points-today-count"> XXX </span>
          </span>
        </span>
      </div> -->
    </div>

<!--
持续时间    <span class="stat-count"> XXX </span> 天
<div class="last-coded">上次编码<span class="last-coded-time"> XXX 天前</span></div>
-->
    </div>

</div>

</div>
</header>

{% endblock %}

{% block container %}

<div class="row">
  <div class="page-header">
    <h2>正在进行的课程</h2>
  </div>
  {% for todo in todos %}
  <div class="col-sm-6 col-md-3">
    <a title="开始学习" href="/study/book/{{todo.book.name}}/lesson/{{todo.lesson.name}}/show" class="thumbnail">
      <div class="caption">
        <h4>{{todo.book.name}}</h4>
        <h3>{{ todo.lesson.name }}</h3>
        <input type="text" value="{{ todo.lesson.stat.percent }}" class="dial" data-height="100" data-width="100" data-fgColor="#07DD3B" data-skin="tron" data-thickness=".13" data-angleOffset="180" data-inputColor="#969696">
        <p>sum:{{ todo.lesson.words | length }}</p>
        <p>上次学习：{{todo.lesson.stat.timestamp | date }}</p>
      </div>
    </a>
  </div>
  {% endfor %}
</div>

<div class="row">
  <div class="page-header">
    <h2>需要进行的考试</h2>
  </div>
  {% for examstat in examstats %}
  <div class="col-sm-6 col-md-3">
    <a title="开始考试" href="exam/{{examstat.exam.id}}/" class="thumbnail">
      <div class="caption">
        <h3>{{ examstat.exam.name }}</h3>
        <input type="text" value="{% widthratio examstat.score examstat.exam.totalpoints 100 %}" class="dial" data-height="100" data-width="100" data-fgColor="#07DD3B" data-skin="tron" data-thickness=".13" data-angleOffset="180" data-inputColor="#969696">
        <p>score:{{ examstat.score }}</p>
        <p>上次考试：{{examstat.timestamp | date }}</p>
      </div>
    </a>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block body_footer %}
<script src="http://cdn.jsdelivr.net/jquery.knob/1.2.2/jquery.knob.min.js"></script>

<script>
$(function() {
    $(".dial").knob({
    	readOnly:true,
        'draw': function () {
          if (this.cv.indexOf('%') == -1)
            $(this.i).val(this.cv + '%')
        }
    });
    $(".knob").knob();
});

function showForm(id) {
  if ($('#'+id).is(":visible")) {
    $('#'+id).hide();
  } else {
    $('#'+id).show();
  }
};
</script>

{% endblock %}

